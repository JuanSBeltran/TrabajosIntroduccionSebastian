<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="/styles/vuelos.css">
  <title>Open World - Vuelos</title>
</head>

<body>

  <header class="header">
    <a href="/index/index.html"><h1>Agencia de Viajes Open World</h1></a>
  </header>
  
  <h1>Vuelos disponibles en Colombia</h1>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Aerol√≠nea</th>
        <th>Origen</th>
        <th>Destino</th>
        <th>Fecha de salida</th>
        <th>Fecha de llegada</th>
        <th>Precio</th>
      </tr>
    </thead>
    <tbody id="tabla-vuelos">
      <tr><td colspan="7" style="text-align:center;">Cargando vuelos...</td></tr>
    </tbody>
  </table>

  <!-- üì¶ Cargar la librer√≠a Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- üîπ Script para mostrar los datos -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const SUPABASE_URL = 'https://umoxzhitoujluggspitx.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtb3h6aGl0b3VqbHVnZ3NwaXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMTU2MTgsImV4cCI6MjA3NjY5MTYxOH0.7FahMznLDSsSaidDFUVpOc9Awy4iB5HQXxTkIL9RdN8';

      const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      try {
        // üîπ Consultamos vuelos con origen y destino
        const { data, error } = await db
          .from('vuelos')
          .select(`
            id,
            aerolinea,
            fecha_salida,
            fecha_llegada,
            precio,
            origen:origen_id (ciudad),
            destino:destino_id (ciudad)
          `);

        if (error) throw error;

        console.log("üì¶ Datos desde Supabase:", data); // üëà √∫til para depurar

        const tbody = document.getElementById("tabla-vuelos");
        tbody.innerHTML = "";

        data.forEach(vuelo => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>${vuelo.id}</td>
            <td>${vuelo.aerolinea}</td>
            <td>${vuelo.origen?.ciudad || "Sin origen"}</td>
            <td>${vuelo.destino?.ciudad || "Sin destino"}</td>
            <td>${new Date(vuelo.fecha_salida).toLocaleString()}</td>
            <td>${new Date(vuelo.fecha_llegada).toLocaleString()}</td>
            <td>$${vuelo.precio?.toLocaleString('es-CO') || "N/A"}</td>
          `;
          tbody.appendChild(fila);
        });

      } catch (err) {
        console.error('‚ùå Error al cargar los vuelos:', err);
        const tbody = document.getElementById("tabla-vuelos");
        tbody.innerHTML = `<tr><td colspan="7" style="color:red; text-align:center;">Error al cargar los vuelos</td></tr>`;
      }
    });
  </script>
</body>
</html>



  